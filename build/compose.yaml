version: "3.8"
services:
    graphql:
      build:
        dockerfile: ../app/Dockerfile
        context: ../app/.
      restart: unless-stopped
      deploy:
        replicas: 1
      ports:
        - "8081:8081"
      depends_on:
        - db
      volumes:
        - ../app:/app

    db:
      image: postgres:latest
      container_name: full_db_postgres
      environment:
        - POSTGRES_USER=${DB_USER}  
        - POSTGRES_PASSWORD=${DB_PASS}
        - POSTGRES_DB=${DB_NAME}
      ports:
        - '5432:5432'
      volumes:
        - pg_data:/var/lib/postgresql/data


volumes:
  pg_data:     
# Networks to be created to facilitate communication between containers
